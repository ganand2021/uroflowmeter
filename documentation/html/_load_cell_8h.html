<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Uroflowmeter: include/LoadCell.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Uroflowmeter
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">LoadCell.h File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>This file defines the interface for the LoadCell module, which includes setup and utility functions for reading and interpreting data from a load cell using the NAU7802 Qwiic scale.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;Wire.h&gt;</code><br />
<code>#include &lt;Arduino.h&gt;</code><br />
<code>#include &lt;SparkFun_Qwiic_Scale_NAU7802_Arduino_Library.h&gt;</code><br />
<code>#include &quot;<a class="el" href="_median_filter_8h_source.html">MedianFilter.h</a>&quot;</code><br />
</div>
<p><a href="_load_cell_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_flow_rate_result.html">FlowRateResult</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Struct to hold the flow rate and volume results.  <a href="struct_flow_rate_result.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a6000449864691a5e74750bda0537e8da" id="r_a6000449864691a5e74750bda0537e8da"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6000449864691a5e74750bda0537e8da">scale_setup</a> ()</td></tr>
<tr class="memdesc:a6000449864691a5e74750bda0537e8da"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets up the scale hardware and initializes communication.  <br /></td></tr>
<tr class="separator:a6000449864691a5e74750bda0537e8da"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adbdb233f6c0146ec3b54681143f4082c" id="r_adbdb233f6c0146ec3b54681143f4082c"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#adbdb233f6c0146ec3b54681143f4082c">get_scale_weight</a> ()</td></tr>
<tr class="memdesc:adbdb233f6c0146ec3b54681143f4082c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the current weight measured by the scale.  <br /></td></tr>
<tr class="separator:adbdb233f6c0146ec3b54681143f4082c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3cdd9456365d866e45a498b31d84c2cb" id="r_a3cdd9456365d866e45a498b31d84c2cb"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3cdd9456365d866e45a498b31d84c2cb">get_flow_rate</a> ()</td></tr>
<tr class="memdesc:a3cdd9456365d866e45a498b31d84c2cb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates and returns the current flow rate.  <br /></td></tr>
<tr class="separator:a3cdd9456365d866e45a498b31d84c2cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7152bd2edbcf11ba2710a956f1481f27" id="r_a7152bd2edbcf11ba2710a956f1481f27"><td class="memItemLeft" align="right" valign="top"><a class="el" href="struct_flow_rate_result.html">FlowRateResult</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7152bd2edbcf11ba2710a956f1481f27">get_flow_info</a> ()</td></tr>
<tr class="memdesc:a7152bd2edbcf11ba2710a956f1481f27"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates and returns flow rate and volume information.  <br /></td></tr>
<tr class="separator:a7152bd2edbcf11ba2710a956f1481f27"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ae16b2283287383f97a79a0df2407eed4" id="r_ae16b2283287383f97a79a0df2407eed4"><td class="memItemLeft" align="right" valign="top">NAU7802&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae16b2283287383f97a79a0df2407eed4">my_scale</a></td></tr>
<tr class="memdesc:ae16b2283287383f97a79a0df2407eed4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Instance of the NAU7802 class to communicate with the Qwiic Scale.  <br /></td></tr>
<tr class="separator:ae16b2283287383f97a79a0df2407eed4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a726aa61c4afe95f49836eca2c90b37c7" id="r_a726aa61c4afe95f49836eca2c90b37c7"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a726aa61c4afe95f49836eca2c90b37c7">previous_weight</a></td></tr>
<tr class="memdesc:a726aa61c4afe95f49836eca2c90b37c7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stores the last measured weight, used to calculate flow rate.  <br /></td></tr>
<tr class="separator:a726aa61c4afe95f49836eca2c90b37c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1f6c585ce27342aae02df5f5e45d9836" id="r_a1f6c585ce27342aae02df5f5e45d9836"><td class="memItemLeft" align="right" valign="top">unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1f6c585ce27342aae02df5f5e45d9836">previous_timestamp</a></td></tr>
<tr class="memdesc:a1f6c585ce27342aae02df5f5e45d9836"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stores the last timestamp of measurement, used in flow rate calculation.  <br /></td></tr>
<tr class="separator:a1f6c585ce27342aae02df5f5e45d9836"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This file defines the interface for the LoadCell module, which includes setup and utility functions for reading and interpreting data from a load cell using the NAU7802 Qwiic scale. </p>
<p>It includes initialization of the load cell, fetching the current weight, calculating the flow rate, and getting flow information based on the weight changes over time. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a7152bd2edbcf11ba2710a956f1481f27" name="a7152bd2edbcf11ba2710a956f1481f27"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7152bd2edbcf11ba2710a956f1481f27">&#9670;&#160;</a></span>get_flow_info()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_flow_rate_result.html">FlowRateResult</a> get_flow_info </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculates and returns flow rate and volume information. </p>
<p>Calculates and returns flow rate and volume information.</p>
<p>This function calculates the flow rate using the weight difference and the elapsed time since the last measurement. It also calculates the total volume based on the current weight. The calculation assumes a specific gravity of the liquid to convert weight to volume.</p>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="struct_flow_rate_result.html" title="Struct to hold the flow rate and volume results.">FlowRateResult</a> A struct containing the calculated flow rate and volume. </dd></dl>

</div>
</div>
<a id="a3cdd9456365d866e45a498b31d84c2cb" name="a3cdd9456365d866e45a498b31d84c2cb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3cdd9456365d866e45a498b31d84c2cb">&#9670;&#160;</a></span>get_flow_rate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float get_flow_rate </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculates and returns the current flow rate. </p>
<p>Calculates and returns the current flow rate.</p>
<p>This function uses the difference in weight and time to calculate the flow rate.</p>
<dl class="section return"><dt>Returns</dt><dd>float The current flow rate. If the calculated flow rate is negative, 0.0 is returned. </dd></dl>

</div>
</div>
<a id="adbdb233f6c0146ec3b54681143f4082c" name="adbdb233f6c0146ec3b54681143f4082c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adbdb233f6c0146ec3b54681143f4082c">&#9670;&#160;</a></span>get_scale_weight()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float get_scale_weight </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns the current weight measured by the scale. </p>
<p>Returns the current weight measured by the scale.</p>
<p>This function reads multiple weight samples, filters them through a median filter, and returns the median as the current weight.</p>
<dl class="section return"><dt>Returns</dt><dd>float The current weight measured by the load cell. If the weight is negative, 0.0 is returned. </dd></dl>

</div>
</div>
<a id="a6000449864691a5e74750bda0537e8da" name="a6000449864691a5e74750bda0537e8da"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6000449864691a5e74750bda0537e8da">&#9670;&#160;</a></span>scale_setup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void scale_setup </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets up the scale hardware and initializes communication. </p>
<p>Sets up the scale hardware and initializes communication.</p>
<p>This function starts the Wire library, sets the clock speed, and initializes the NAU7802 scale. It also sets the calibration factor and calibrates the Analog Front End (AFE) of the NAU7802. </p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="ae16b2283287383f97a79a0df2407eed4" name="ae16b2283287383f97a79a0df2407eed4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae16b2283287383f97a79a0df2407eed4">&#9670;&#160;</a></span>my_scale</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">NAU7802 my_scale</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Instance of the NAU7802 class to communicate with the Qwiic Scale. </p>
<p>Instance of the NAU7802 class to communicate with the Qwiic Scale. </p>

</div>
</div>
<a id="a1f6c585ce27342aae02df5f5e45d9836" name="a1f6c585ce27342aae02df5f5e45d9836"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1f6c585ce27342aae02df5f5e45d9836">&#9670;&#160;</a></span>previous_timestamp</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned long previous_timestamp</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Stores the last timestamp of measurement, used in flow rate calculation. </p>
<p>Stores the last timestamp of measurement, used in flow rate calculation. </p>

</div>
</div>
<a id="a726aa61c4afe95f49836eca2c90b37c7" name="a726aa61c4afe95f49836eca2c90b37c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a726aa61c4afe95f49836eca2c90b37c7">&#9670;&#160;</a></span>previous_weight</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float previous_weight</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Stores the last measured weight, used to calculate flow rate. </p>
<p>Stores the last measured weight, used to calculate flow rate. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
