<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Uroflowmeter: src/main.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Uroflowmeter
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">main.cpp File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Main file for a project that involves connecting an ESP32 device to AWS IoT Core, managing LED states, and measuring flow rates with a sensor.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;Arduino.h&gt;</code><br />
<code>#include &lt;WiFiClientSecure.h&gt;</code><br />
<code>#include &lt;PubSubClient.h&gt;</code><br />
<code>#include &lt;ArduinoJson.h&gt;</code><br />
<code>#include &quot;<a class="el" href="_wi_fi_manager_8h_source.html">WiFiManager.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_a_w_s_manager_8h_source.html">AWSManager.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_u_i_setup_8h_source.html">UISetup.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="secrets_8h_source.html">secrets.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_timestamp_8h_source.html">Timestamp.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_load_cell_8h_source.html">LoadCell.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a59b7e2d7374eb07497234a32456f6e35" id="r_a59b7e2d7374eb07497234a32456f6e35"><td class="memItemLeft" align="right" valign="top">PubSubClient&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a59b7e2d7374eb07497234a32456f6e35">mqtt_client</a> (<a class="el" href="_a_w_s_manager_8cpp.html#a9f497dfb17a59466e58e1b1a4ae34ee3">secure_client</a>)</td></tr>
<tr class="memdesc:a59b7e2d7374eb07497234a32456f6e35"><td class="mdescLeft">&#160;</td><td class="mdescRight">MQTT client instance using the secure WiFi client.  <br /></td></tr>
<tr class="separator:a59b7e2d7374eb07497234a32456f6e35"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac9c56dfe5d67aab23f66e5fba08c01a8" id="r_ac9c56dfe5d67aab23f66e5fba08c01a8"><td class="memItemLeft" align="right" valign="top">DynamicJsonDocument&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac9c56dfe5d67aab23f66e5fba08c01a8">pub_doc</a> (256)</td></tr>
<tr class="memdesc:ac9c56dfe5d67aab23f66e5fba08c01a8"><td class="mdescLeft">&#160;</td><td class="mdescRight">JSON document for publishing messages, with a buffer size of 256 bytes.  <br /></td></tr>
<tr class="separator:ac9c56dfe5d67aab23f66e5fba08c01a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a95ff6936caea1735195051a8f55b78fb" id="r_a95ff6936caea1735195051a8f55b78fb"><td class="memItemLeft" align="right" valign="top">NTPClient&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a95ff6936caea1735195051a8f55b78fb">time_client</a> (<a class="el" href="#a7f86660350f23d81b7d8bd36f61a4778">ntp_udp</a>, <a class="el" href="_timestamp_8h.html#a751e3f85cd240e89d390d18996089cd0">NTP_SERVER</a>)</td></tr>
<tr class="memdesc:a95ff6936caea1735195051a8f55b78fb"><td class="mdescLeft">&#160;</td><td class="mdescRight">NTP client for time synchronization.  <br /></td></tr>
<tr class="separator:a95ff6936caea1735195051a8f55b78fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad61bd19de422f745c4f8706997898625" id="r_ad61bd19de422f745c4f8706997898625"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad61bd19de422f745c4f8706997898625">led_setup</a> ()</td></tr>
<tr class="memdesc:ad61bd19de422f745c4f8706997898625"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes LEDs as output and sets an initial state.  <br /></td></tr>
<tr class="separator:ad61bd19de422f745c4f8706997898625"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9df9d518e264c01dc3cde5a48d6fdce3" id="r_a9df9d518e264c01dc3cde5a48d6fdce3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9df9d518e264c01dc3cde5a48d6fdce3">toggleBlueLED</a> ()</td></tr>
<tr class="memdesc:a9df9d518e264c01dc3cde5a48d6fdce3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Toggles the state of the blue LED.  <br /></td></tr>
<tr class="separator:a9df9d518e264c01dc3cde5a48d6fdce3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c891c9ab1dc7c4b07aa8662cf40fc9a" id="r_a3c891c9ab1dc7c4b07aa8662cf40fc9a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3c891c9ab1dc7c4b07aa8662cf40fc9a">measureFlowRateTask</a> (void *parameter)</td></tr>
<tr class="memdesc:a3c891c9ab1dc7c4b07aa8662cf40fc9a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Task function to continuously measure the flow rate.  <br /></td></tr>
<tr class="separator:a3c891c9ab1dc7c4b07aa8662cf40fc9a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4fc01d736fe50cf5b977f755b675f11d" id="r_a4fc01d736fe50cf5b977f755b675f11d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4fc01d736fe50cf5b977f755b675f11d">setup</a> ()</td></tr>
<tr class="memdesc:a4fc01d736fe50cf5b977f755b675f11d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Setup function for the Arduino sketch.  <br /></td></tr>
<tr class="separator:a4fc01d736fe50cf5b977f755b675f11d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe461d27b9c48d5921c00d521181f12f" id="r_afe461d27b9c48d5921c00d521181f12f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afe461d27b9c48d5921c00d521181f12f">loop</a> ()</td></tr>
<tr class="memdesc:afe461d27b9c48d5921c00d521181f12f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Main loop function for the Arduino sketch.  <br /></td></tr>
<tr class="separator:afe461d27b9c48d5921c00d521181f12f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a289939adbb4b579689aff9bdbd034cae" id="r_a289939adbb4b579689aff9bdbd034cae"><td class="memItemLeft" align="right" valign="top">const byte&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a289939adbb4b579689aff9bdbd034cae">GREEN_LED</a> = 27</td></tr>
<tr class="separator:a289939adbb4b579689aff9bdbd034cae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8342cade79877346fa253e521b994e5b" id="r_a8342cade79877346fa253e521b994e5b"><td class="memItemLeft" align="right" valign="top">const byte&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8342cade79877346fa253e521b994e5b">RED_LED</a> = 33</td></tr>
<tr class="separator:a8342cade79877346fa253e521b994e5b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5903a088e38cc614c92881ac59af81c4" id="r_a5903a088e38cc614c92881ac59af81c4"><td class="memItemLeft" align="right" valign="top">const byte&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5903a088e38cc614c92881ac59af81c4">BLUE_LED</a> = 12</td></tr>
<tr class="separator:a5903a088e38cc614c92881ac59af81c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af561bb7820311bd027c2e3293bae0e35" id="r_af561bb7820311bd027c2e3293bae0e35"><td class="memItemLeft" align="right" valign="top">const byte&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af561bb7820311bd027c2e3293bae0e35">CHARGING_LED</a> = 12</td></tr>
<tr class="separator:af561bb7820311bd027c2e3293bae0e35"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9f497dfb17a59466e58e1b1a4ae34ee3" id="r_a9f497dfb17a59466e58e1b1a4ae34ee3"><td class="memItemLeft" align="right" valign="top">WiFiClientSecure&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9f497dfb17a59466e58e1b1a4ae34ee3">secure_client</a></td></tr>
<tr class="memdesc:a9f497dfb17a59466e58e1b1a4ae34ee3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Secure client for WiFi connections.  <br /></td></tr>
<tr class="separator:a9f497dfb17a59466e58e1b1a4ae34ee3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac4fbed25c9d82b26a56813f4892022d8" id="r_ac4fbed25c9d82b26a56813f4892022d8"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac4fbed25c9d82b26a56813f4892022d8">HOSTNAME</a> = &quot;ESP-WiFi-GUI&quot;</td></tr>
<tr class="memdesc:ac4fbed25c9d82b26a56813f4892022d8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Hostname for the device.  <br /></td></tr>
<tr class="separator:ac4fbed25c9d82b26a56813f4892022d8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7f86660350f23d81b7d8bd36f61a4778" id="r_a7f86660350f23d81b7d8bd36f61a4778"><td class="memItemLeft" align="right" valign="top">WiFiUDP&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7f86660350f23d81b7d8bd36f61a4778">ntp_udp</a></td></tr>
<tr class="memdesc:a7f86660350f23d81b7d8bd36f61a4778"><td class="mdescLeft">&#160;</td><td class="mdescRight">UDP instance for NTP communication.  <br /></td></tr>
<tr class="separator:a7f86660350f23d81b7d8bd36f61a4778"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae16b2283287383f97a79a0df2407eed4" id="r_ae16b2283287383f97a79a0df2407eed4"><td class="memItemLeft" align="right" valign="top">NAU7802&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae16b2283287383f97a79a0df2407eed4">my_scale</a></td></tr>
<tr class="memdesc:ae16b2283287383f97a79a0df2407eed4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Instance of the NAU7802 load cell amplifier.  <br /></td></tr>
<tr class="separator:ae16b2283287383f97a79a0df2407eed4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ada1a895a5ff67fb36ed9a4765f2274d2" id="r_ada1a895a5ff67fb36ed9a4765f2274d2"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ada1a895a5ff67fb36ed9a4765f2274d2">isConnected</a> = false</td></tr>
<tr class="memdesc:ada1a895a5ff67fb36ed9a4765f2274d2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Connection status flag.  <br /></td></tr>
<tr class="separator:ada1a895a5ff67fb36ed9a4765f2274d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af714c2132c62a69b96c0e2ffe338944e" id="r_af714c2132c62a69b96c0e2ffe338944e"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af714c2132c62a69b96c0e2ffe338944e">ssid_text</a></td></tr>
<tr class="separator:af714c2132c62a69b96c0e2ffe338944e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a02e520e9de360b7d35f84e0eeab5e2da" id="r_a02e520e9de360b7d35f84e0eeab5e2da"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a02e520e9de360b7d35f84e0eeab5e2da">password_text</a></td></tr>
<tr class="memdesc:a02e520e9de360b7d35f84e0eeab5e2da"><td class="mdescLeft">&#160;</td><td class="mdescRight">Variables for storing SSID and password inputs.  <br /></td></tr>
<tr class="separator:a02e520e9de360b7d35f84e0eeab5e2da"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a726aa61c4afe95f49836eca2c90b37c7" id="r_a726aa61c4afe95f49836eca2c90b37c7"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a726aa61c4afe95f49836eca2c90b37c7">previous_weight</a> = 0</td></tr>
<tr class="memdesc:a726aa61c4afe95f49836eca2c90b37c7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Previous weight measured by the scale.  <br /></td></tr>
<tr class="separator:a726aa61c4afe95f49836eca2c90b37c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1f6c585ce27342aae02df5f5e45d9836" id="r_a1f6c585ce27342aae02df5f5e45d9836"><td class="memItemLeft" align="right" valign="top">unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1f6c585ce27342aae02df5f5e45d9836">previous_timestamp</a> = 0</td></tr>
<tr class="memdesc:a1f6c585ce27342aae02df5f5e45d9836"><td class="mdescLeft">&#160;</td><td class="mdescRight">Timestamp of the previous measurement.  <br /></td></tr>
<tr class="separator:a1f6c585ce27342aae02df5f5e45d9836"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3ecd7492d29572181cc7fb6be4326adb" id="r_a3ecd7492d29572181cc7fb6be4326adb"><td class="memItemLeft" align="right" valign="top">volatile float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3ecd7492d29572181cc7fb6be4326adb">flow_rate</a> = 0.0</td></tr>
<tr class="memdesc:a3ecd7492d29572181cc7fb6be4326adb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Current flow rate.  <br /></td></tr>
<tr class="separator:a3ecd7492d29572181cc7fb6be4326adb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afd5928f9da93941740ed17d03ceda93b" id="r_afd5928f9da93941740ed17d03ceda93b"><td class="memItemLeft" align="right" valign="top">volatile float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afd5928f9da93941740ed17d03ceda93b">volume</a> = 0.0</td></tr>
<tr class="memdesc:afd5928f9da93941740ed17d03ceda93b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Total volume measured.  <br /></td></tr>
<tr class="separator:afd5928f9da93941740ed17d03ceda93b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa592592ded1d72b2970d33f58e2db2c6" id="r_aa592592ded1d72b2970d33f58e2db2c6"><td class="memItemLeft" align="right" valign="top">const float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa592592ded1d72b2970d33f58e2db2c6">flow_rate_threshold</a> = 5.0</td></tr>
<tr class="memdesc:aa592592ded1d72b2970d33f58e2db2c6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Threshold for significant flow rate to trigger actions.  <br /></td></tr>
<tr class="separator:aa592592ded1d72b2970d33f58e2db2c6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a42cc85bc12e25d1c6206a5044d8174e4" id="r_a42cc85bc12e25d1c6206a5044d8174e4"><td class="memItemLeft" align="right" valign="top">unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a42cc85bc12e25d1c6206a5044d8174e4">current_time</a> = 0</td></tr>
<tr class="memdesc:a42cc85bc12e25d1c6206a5044d8174e4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Current time since the program started.  <br /></td></tr>
<tr class="separator:a42cc85bc12e25d1c6206a5044d8174e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a471abf687001d052decbbda33e0b8ffb" id="r_a471abf687001d052decbbda33e0b8ffb"><td class="memItemLeft" align="right" valign="top">unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a471abf687001d052decbbda33e0b8ffb">last_active_time</a> = 0</td></tr>
<tr class="memdesc:a471abf687001d052decbbda33e0b8ffb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Last time the system was active.  <br /></td></tr>
<tr class="separator:a471abf687001d052decbbda33e0b8ffb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1cf11716f848e9df0d2e0c3e4f5cfea3" id="r_a1cf11716f848e9df0d2e0c3e4f5cfea3"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1cf11716f848e9df0d2e0c3e4f5cfea3">blueLedState</a> = false</td></tr>
<tr class="memdesc:a1cf11716f848e9df0d2e0c3e4f5cfea3"><td class="mdescLeft">&#160;</td><td class="mdescRight">State of the blue LED.  <br /></td></tr>
<tr class="separator:a1cf11716f848e9df0d2e0c3e4f5cfea3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8124e444ac3f4bc6b0003e3194316c35" id="r_a8124e444ac3f4bc6b0003e3194316c35"><td class="memItemLeft" align="right" valign="top">String&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8124e444ac3f4bc6b0003e3194316c35">publish_string</a></td></tr>
<tr class="memdesc:a8124e444ac3f4bc6b0003e3194316c35"><td class="mdescLeft">&#160;</td><td class="mdescRight">String for publishing data.  <br /></td></tr>
<tr class="separator:a8124e444ac3f4bc6b0003e3194316c35"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a285fa2d1564ceaa641276e4b6c5e1357" id="r_a285fa2d1564ceaa641276e4b6c5e1357"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a285fa2d1564ceaa641276e4b6c5e1357">battery_value</a> = 0.0</td></tr>
<tr class="memdesc:a285fa2d1564ceaa641276e4b6c5e1357"><td class="mdescLeft">&#160;</td><td class="mdescRight">Current battery voltage.  <br /></td></tr>
<tr class="separator:a285fa2d1564ceaa641276e4b6c5e1357"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Main file for a project that involves connecting an ESP32 device to AWS IoT Core, managing LED states, and measuring flow rates with a sensor. </p>
<p>This file includes initialization for WiFi, MQTT messaging, JSON document handling, and sensor data processing. It also includes setup and loop functions that are typical in Arduino sketches, managing hardware states and network communications. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="ad61bd19de422f745c4f8706997898625" name="ad61bd19de422f745c4f8706997898625"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad61bd19de422f745c4f8706997898625">&#9670;&#160;</a></span>led_setup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void led_setup </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes LEDs as output and sets an initial state. </p>

</div>
</div>
<a id="afe461d27b9c48d5921c00d521181f12f" name="afe461d27b9c48d5921c00d521181f12f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afe461d27b9c48d5921c00d521181f12f">&#9670;&#160;</a></span>loop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void loop </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Main loop function for the Arduino sketch. </p>
<p>Handles battery monitoring, MQTT connection management, and publishing of sensor data. </p>

</div>
</div>
<a id="a3c891c9ab1dc7c4b07aa8662cf40fc9a" name="a3c891c9ab1dc7c4b07aa8662cf40fc9a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c891c9ab1dc7c4b07aa8662cf40fc9a">&#9670;&#160;</a></span>measureFlowRateTask()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void measureFlowRateTask </td>
          <td>(</td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>parameter</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Task function to continuously measure the flow rate. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">parameter</td><td>Unused parameter, for task function signature compliance. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a59b7e2d7374eb07497234a32456f6e35" name="a59b7e2d7374eb07497234a32456f6e35"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a59b7e2d7374eb07497234a32456f6e35">&#9670;&#160;</a></span>mqtt_client()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PubSubClient mqtt_client </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="_a_w_s_manager_8cpp.html#a9f497dfb17a59466e58e1b1a4ae34ee3">secure_client</a></td>          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>MQTT client instance using the secure WiFi client. </p>

</div>
</div>
<a id="ac9c56dfe5d67aab23f66e5fba08c01a8" name="ac9c56dfe5d67aab23f66e5fba08c01a8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac9c56dfe5d67aab23f66e5fba08c01a8">&#9670;&#160;</a></span>pub_doc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">DynamicJsonDocument pub_doc </td>
          <td>(</td>
          <td class="paramtype">256</td>          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>JSON document for publishing messages, with a buffer size of 256 bytes. </p>

</div>
</div>
<a id="a4fc01d736fe50cf5b977f755b675f11d" name="a4fc01d736fe50cf5b977f755b675f11d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4fc01d736fe50cf5b977f755b675f11d">&#9670;&#160;</a></span>setup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setup </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Setup function for the Arduino sketch. </p>
<p>Initializes serial communication, LEDs, WiFi connection, AWS IoT Core connection, and tasks for measuring flow rate. </p>

</div>
</div>
<a id="a95ff6936caea1735195051a8f55b78fb" name="a95ff6936caea1735195051a8f55b78fb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a95ff6936caea1735195051a8f55b78fb">&#9670;&#160;</a></span>time_client()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">NTPClient time_client </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="#a7f86660350f23d81b7d8bd36f61a4778">ntp_udp</a></td>          <td class="paramname"><span class="paramname">, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_timestamp_8h.html#a751e3f85cd240e89d390d18996089cd0">NTP_SERVER</a></td>          <td class="paramname"><span class="paramname"></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>NTP client for time synchronization. </p>

</div>
</div>
<a id="a9df9d518e264c01dc3cde5a48d6fdce3" name="a9df9d518e264c01dc3cde5a48d6fdce3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9df9d518e264c01dc3cde5a48d6fdce3">&#9670;&#160;</a></span>toggleBlueLED()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void toggleBlueLED </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Toggles the state of the blue LED. </p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a285fa2d1564ceaa641276e4b6c5e1357" name="a285fa2d1564ceaa641276e4b6c5e1357"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a285fa2d1564ceaa641276e4b6c5e1357">&#9670;&#160;</a></span>battery_value</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float battery_value = 0.0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Current battery voltage. </p>

</div>
</div>
<a id="a5903a088e38cc614c92881ac59af81c4" name="a5903a088e38cc614c92881ac59af81c4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5903a088e38cc614c92881ac59af81c4">&#9670;&#160;</a></span>BLUE_LED</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const byte BLUE_LED = 12</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a1cf11716f848e9df0d2e0c3e4f5cfea3" name="a1cf11716f848e9df0d2e0c3e4f5cfea3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1cf11716f848e9df0d2e0c3e4f5cfea3">&#9670;&#160;</a></span>blueLedState</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool blueLedState = false</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>State of the blue LED. </p>

</div>
</div>
<a id="af561bb7820311bd027c2e3293bae0e35" name="af561bb7820311bd027c2e3293bae0e35"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af561bb7820311bd027c2e3293bae0e35">&#9670;&#160;</a></span>CHARGING_LED</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const byte CHARGING_LED = 12</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a42cc85bc12e25d1c6206a5044d8174e4" name="a42cc85bc12e25d1c6206a5044d8174e4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a42cc85bc12e25d1c6206a5044d8174e4">&#9670;&#160;</a></span>current_time</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned long current_time = 0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Current time since the program started. </p>

</div>
</div>
<a id="a3ecd7492d29572181cc7fb6be4326adb" name="a3ecd7492d29572181cc7fb6be4326adb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3ecd7492d29572181cc7fb6be4326adb">&#9670;&#160;</a></span>flow_rate</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile float flow_rate = 0.0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Current flow rate. </p>

</div>
</div>
<a id="aa592592ded1d72b2970d33f58e2db2c6" name="aa592592ded1d72b2970d33f58e2db2c6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa592592ded1d72b2970d33f58e2db2c6">&#9670;&#160;</a></span>flow_rate_threshold</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const float flow_rate_threshold = 5.0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Threshold for significant flow rate to trigger actions. </p>

</div>
</div>
<a id="a289939adbb4b579689aff9bdbd034cae" name="a289939adbb4b579689aff9bdbd034cae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a289939adbb4b579689aff9bdbd034cae">&#9670;&#160;</a></span>GREEN_LED</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const byte GREEN_LED = 27</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ac4fbed25c9d82b26a56813f4892022d8" name="ac4fbed25c9d82b26a56813f4892022d8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac4fbed25c9d82b26a56813f4892022d8">&#9670;&#160;</a></span>HOSTNAME</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* HOSTNAME = &quot;ESP-WiFi-GUI&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Hostname for the device. </p>
<p>Hostname for the WiFi AP and ESPUI server. </p>

</div>
</div>
<a id="ada1a895a5ff67fb36ed9a4765f2274d2" name="ada1a895a5ff67fb36ed9a4765f2274d2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ada1a895a5ff67fb36ed9a4765f2274d2">&#9670;&#160;</a></span>isConnected</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool isConnected = false</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Connection status flag. </p>
<p>Tracks the connection status of the WiFi network. </p>

</div>
</div>
<a id="a471abf687001d052decbbda33e0b8ffb" name="a471abf687001d052decbbda33e0b8ffb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a471abf687001d052decbbda33e0b8ffb">&#9670;&#160;</a></span>last_active_time</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned long last_active_time = 0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Last time the system was active. </p>

</div>
</div>
<a id="ae16b2283287383f97a79a0df2407eed4" name="ae16b2283287383f97a79a0df2407eed4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae16b2283287383f97a79a0df2407eed4">&#9670;&#160;</a></span>my_scale</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">NAU7802 my_scale</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Instance of the NAU7802 load cell amplifier. </p>
<p>Instance of the NAU7802 class to communicate with the Qwiic Scale. </p>

</div>
</div>
<a id="a7f86660350f23d81b7d8bd36f61a4778" name="a7f86660350f23d81b7d8bd36f61a4778"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7f86660350f23d81b7d8bd36f61a4778">&#9670;&#160;</a></span>ntp_udp</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">WiFiUDP ntp_udp</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>UDP instance for NTP communication. </p>
<p>UDP client for NTP communication. </p>

</div>
</div>
<a id="a02e520e9de360b7d35f84e0eeab5e2da" name="a02e520e9de360b7d35f84e0eeab5e2da"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a02e520e9de360b7d35f84e0eeab5e2da">&#9670;&#160;</a></span>password_text</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t password_text</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Variables for storing SSID and password inputs. </p>

</div>
</div>
<a id="a1f6c585ce27342aae02df5f5e45d9836" name="a1f6c585ce27342aae02df5f5e45d9836"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1f6c585ce27342aae02df5f5e45d9836">&#9670;&#160;</a></span>previous_timestamp</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned long previous_timestamp = 0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Timestamp of the previous measurement. </p>
<p>Stores the last timestamp of measurement, used in flow rate calculation. </p>

</div>
</div>
<a id="a726aa61c4afe95f49836eca2c90b37c7" name="a726aa61c4afe95f49836eca2c90b37c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a726aa61c4afe95f49836eca2c90b37c7">&#9670;&#160;</a></span>previous_weight</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float previous_weight = 0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Previous weight measured by the scale. </p>
<p>Stores the last measured weight, used to calculate flow rate. </p>

</div>
</div>
<a id="a8124e444ac3f4bc6b0003e3194316c35" name="a8124e444ac3f4bc6b0003e3194316c35"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8124e444ac3f4bc6b0003e3194316c35">&#9670;&#160;</a></span>publish_string</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">String publish_string</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>String for publishing data. </p>

</div>
</div>
<a id="a8342cade79877346fa253e521b994e5b" name="a8342cade79877346fa253e521b994e5b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8342cade79877346fa253e521b994e5b">&#9670;&#160;</a></span>RED_LED</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const byte RED_LED = 33</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a9f497dfb17a59466e58e1b1a4ae34ee3" name="a9f497dfb17a59466e58e1b1a4ae34ee3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9f497dfb17a59466e58e1b1a4ae34ee3">&#9670;&#160;</a></span>secure_client</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">WiFiClientSecure secure_client</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Secure client for WiFi connections. </p>
<p>Secure client instance for establishing encrypted connections. </p>

</div>
</div>
<a id="af714c2132c62a69b96c0e2ffe338944e" name="af714c2132c62a69b96c0e2ffe338944e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af714c2132c62a69b96c0e2ffe338944e">&#9670;&#160;</a></span>ssid_text</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t ssid_text</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="afd5928f9da93941740ed17d03ceda93b" name="afd5928f9da93941740ed17d03ceda93b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afd5928f9da93941740ed17d03ceda93b">&#9670;&#160;</a></span>volume</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile float volume = 0.0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Total volume measured. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
